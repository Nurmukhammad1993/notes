{% extends "base.html" %}

{% block content %}
  <section class="rounded-3xl border border-slate-200 bg-white/70 p-6 backdrop-blur dark:border-slate-800 dark:bg-slate-900/40">
    <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
      <div>
        <h2 class="text-base font-semibold">Редактирование</h2>
        <p class="mt-1 text-xs text-slate-600 dark:text-slate-300">
          Заметка #{{ note.id }} ·
          Обновлено: <time data-utc="{{ note.updated_at.isoformat() }}Z">{{ note.updated_at.strftime('%Y-%m-%d %H:%M') }}</time>
        </p>
        <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">Ctrl+Enter для сохранения</p>
      </div>

      <div class="flex items-center justify-end gap-2">
        <a href="/" class="inline-flex h-10 items-center justify-center rounded-2xl border border-slate-200 bg-white/60 px-4 text-sm font-medium hover:bg-white dark:border-slate-800 dark:bg-slate-950/40 dark:hover:bg-slate-950/60">Назад</a>

        <details class="relative">
          <summary class="inline-flex h-10 cursor-pointer list-none items-center justify-center rounded-2xl border border-slate-200 bg-white/60 px-3 text-sm font-medium hover:bg-white dark:border-slate-800 dark:bg-slate-950/40 dark:hover:bg-slate-950/60 [&::-webkit-details-marker]:hidden" aria-label="Действия">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="5" r="1" />
              <circle cx="12" cy="12" r="1" />
              <circle cx="12" cy="19" r="1" />
            </svg>
          </summary>
          <div class="absolute right-0 z-50 mt-2 w-56 overflow-hidden rounded-2xl border border-slate-200 bg-white/95 p-2 shadow-sm backdrop-blur dark:border-slate-800 dark:bg-slate-950/95">
            <form method="post" action="/notes/{{ note.id }}/pin">
              <button type="submit" class="flex h-10 w-full items-center gap-2 rounded-xl px-3 text-left text-sm font-medium hover:bg-slate-100 dark:hover:bg-slate-900">
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M14 9l7 7-4 4-7-7" />
                  <path d="M3 21l6-6" />
                  <path d="M8 8l8 8" />
                </svg>
                {{ 'Открепить' if note.pinned else 'Закрепить' }}
              </button>
            </form>

            <form method="post" action="/notes/{{ note.id }}/archive">
              <button type="submit" class="flex h-10 w-full items-center gap-2 rounded-xl px-3 text-left text-sm font-medium hover:bg-slate-100 dark:hover:bg-slate-900">
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 8v13H3V8" />
                  <path d="M1 3h22v5H1z" />
                  <path d="M10 12h4" />
                </svg>
                {{ 'Вернуть из архива' if note.archived else 'В архив' }}
              </button>
            </form>

            <div class="my-1 h-px bg-slate-200/70 dark:bg-slate-800/70"></div>

            <form method="post" action="/notes/{{ note.id }}/delete" onsubmit="return confirm('Удалить заметку?');">
              <button type="submit" class="flex h-10 w-full items-center gap-2 rounded-xl px-3 text-left text-sm font-semibold text-rose-700 hover:bg-rose-50 dark:text-rose-200 dark:hover:bg-rose-950/40">
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 6h18" />
                  <path d="M8 6V4h8v2" />
                  <path d="M19 6l-1 14H6L5 6" />
                  <path d="M10 11v6" />
                  <path d="M14 11v6" />
                </svg>
                Удалить
              </button>
            </form>
          </div>
        </details>
      </div>
    </div>

    <form class="mt-5 grid gap-3" method="post" action="/notes/{{ note.id }}" data-ctrl-enter-submit="1">
      <div>
        <label class="text-xs font-medium text-slate-700 dark:text-slate-300">Заголовок</label>
        <input
          name="title"
          required
          maxlength="200"
          value="{{ note.title }}"
          class="mt-1 w-full rounded-2xl border border-slate-200 bg-white/70 px-3 py-2 text-sm text-slate-900 outline-none ring-1 ring-transparent focus:border-slate-300 focus:ring-indigo-500/30 dark:border-slate-800 dark:bg-slate-950/50 dark:text-slate-100 dark:focus:border-slate-700 dark:focus:ring-indigo-500/40"
        />
      </div>
      <div>
        <label class="text-xs font-medium text-slate-700 dark:text-slate-300">Текст</label>
        <textarea
          name="content"
          rows="10"
          data-autosize="1"
          class="mt-1 w-full resize-none rounded-2xl border border-slate-200 bg-white/70 px-3 py-2 text-sm text-slate-900 outline-none ring-1 ring-transparent focus:border-slate-300 focus:ring-indigo-500/30 dark:border-slate-800 dark:bg-slate-950/50 dark:text-slate-100 dark:focus:border-slate-700 dark:focus:ring-indigo-500/40"
        >{{ note.content }}</textarea>
      </div>

      <div class="flex items-center justify-end gap-2">
        <button class="inline-flex h-10 items-center justify-center rounded-2xl bg-indigo-600 px-4 text-sm font-semibold text-white hover:bg-indigo-500" type="submit">
          <span class="inline-flex items-center gap-2">
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2Z" />
              <path d="M17 21v-8H7v8" />
              <path d="M7 3v5h8" />
            </svg>
            Сохранить
          </span>
        </button>
      </div>
    </form>
  </section>
{% endblock %}
